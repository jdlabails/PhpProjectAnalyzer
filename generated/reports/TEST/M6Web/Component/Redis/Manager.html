<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
	<head>
		<meta http-equiv="Content-Language" content="en" />
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<title>Projet Redis : code coverage of M6Web\Component\Redis\Manager</title>
		<link rel="stylesheet" media="screen" type="text/css" href="../../../screen.css" title="Screen" />
	</head>
	<body>
		<div id="header">
			<h1>Code coverage of <a href="../../../index.html">Projet Redis</a>: M6Web\Component\Redis\Manager</h1>
			<h2>Class code coverage <span>85.47%</span></h2>
		</div>
		<div id="page">
			<div id="content">
				<h3>Methods</h3>
				<ul class="summary">
					
						
							<li>
								
								
									<div class="bar">
										<div class="background"></div>
										<div class="graph" style="width: 100%"></div>
										<div class="label">
											<span class="percent">100%</span>
											<a href="#setCurrentDb">setCurrentDb</a>
										</div>
									</div>
								
							</li>
						
							<li>
								
								
									<div class="bar">
										<div class="background"></div>
										<div class="graph" style="width: 66.67%"></div>
										<div class="label">
											<span class="percent">66.67%</span>
											<a href="#getCurrentDb">getCurrentDb</a>
										</div>
									</div>
								
							</li>
						
							<li>
								
								
									<div class="bar">
										<div class="background"></div>
										<div class="graph" style="width: 100%"></div>
										<div class="label">
											<span class="percent">100%</span>
											<a href="#notifyEvent">notifyEvent</a>
										</div>
									</div>
								
							</li>
						
							<li>
								
								
									<div class="bar">
										<div class="background"></div>
										<div class="graph" style="width: 69.23%"></div>
										<div class="label">
											<span class="percent">69.23%</span>
											<a href="#setEventDispatcher">setEventDispatcher</a>
										</div>
									</div>
								
							</li>
						
							<li>
								
								
									<div class="bar">
										<div class="background"></div>
										<div class="graph" style="width: 83.33%"></div>
										<div class="label">
											<span class="percent">83.33%</span>
											<a href="#init">init</a>
										</div>
									</div>
								
							</li>
						
							<li>
								
								
									<div class="bar">
										<div class="background"></div>
										<div class="graph" style="width: 100%"></div>
										<div class="label">
											<span class="percent">100%</span>
											<a href="#getCompress">getCompress</a>
										</div>
									</div>
								
							</li>
						
							<li>
								
								
									<div class="bar">
										<div class="background"></div>
										<div class="graph" style="width: 66.67%"></div>
										<div class="label">
											<span class="percent">66.67%</span>
											<a href="#checkServerConfig">checkServerConfig</a>
										</div>
									</div>
								
							</li>
						
							<li>
								
								
									<div class="bar">
										<div class="background"></div>
										<div class="graph" style="width: 100%"></div>
										<div class="label">
											<span class="percent">100%</span>
											<a href="#getTimeout">getTimeout</a>
										</div>
									</div>
								
							</li>
						
							<li>
								
								
									<div class="bar">
										<div class="background"></div>
										<div class="graph" style="width: 100%"></div>
										<div class="label">
											<span class="percent">100%</span>
											<a href="#getReadWriteTimeout">getReadWriteTimeout</a>
										</div>
									</div>
								
							</li>
						
							<li>
								
								
									<div class="bar">
										<div class="background"></div>
										<div class="graph" style="width: 100%"></div>
										<div class="label">
											<span class="percent">100%</span>
											<a href="#getServerConfig">getServerConfig</a>
										</div>
									</div>
								
							</li>
						
							<li>
								
								
									<div class="bar">
										<div class="background"></div>
										<div class="graph" style="width: 83.33%"></div>
										<div class="label">
											<span class="percent">83.33%</span>
											<a href="#setServerConfig">setServerConfig</a>
										</div>
									</div>
								
							</li>
						
							<li>
								
								
									<div class="bar">
										<div class="background"></div>
										<div class="graph" style="width: 100%"></div>
										<div class="label">
											<span class="percent">100%</span>
											<a href="#getServerId">getServerId</a>
										</div>
									</div>
								
							</li>
						
							<li>
								
								
									<div class="bar">
										<div class="background"></div>
										<div class="graph" style="width: 100%"></div>
										<div class="label">
											<span class="percent">100%</span>
											<a href="#getRedis">getRedis</a>
										</div>
									</div>
								
							</li>
						
							<li>
								
								
									<div class="bar">
										<div class="background"></div>
										<div class="graph" style="width: 84.62%"></div>
										<div class="label">
											<span class="percent">84.62%</span>
											<a href="#getRedisFromServerConfig">getRedisFromServerConfig</a>
										</div>
									</div>
								
							</li>
						
							<li>
								
								
									<div class="bar">
										<div class="background"></div>
										<div class="graph" style="width: 100%"></div>
										<div class="label">
											<span class="percent">100%</span>
											<a href="#getNewRedis">getNewRedis</a>
										</div>
									</div>
								
							</li>
						
							<li>
								
								
									<div class="bar">
										<div class="background"></div>
										<div class="graph" style="width: 100%"></div>
										<div class="label">
											<span class="percent">100%</span>
											<a href="#connectServer">connectServer</a>
										</div>
									</div>
								
							</li>
						
							<li>
								
								
									<div class="bar">
										<div class="background"></div>
										<div class="graph" style="width: 100%"></div>
										<div class="label">
											<span class="percent">100%</span>
											<a href="#compress">compress</a>
										</div>
									</div>
								
							</li>
						
							<li>
								
								
									<div class="bar">
										<div class="background"></div>
										<div class="graph" style="width: 100%"></div>
										<div class="label">
											<span class="percent">100%</span>
											<a href="#uncompress">uncompress</a>
										</div>
									</div>
								
							</li>
						
							<li>
								
								
									<div class="bar">
										<div class="background"></div>
										<div class="graph" style="width: 0%"></div>
										<div class="label">
											<span class="percent">0%</span>
											<a href="#forgetDeadOrAliveRedis">forgetDeadOrAliveRedis</a>
										</div>
									</div>
								
							</li>
						
					
				</ul>
				<h3>Source</h3>
				<table cellpadding="0" cellspacing="0" class="source">
					<tr><th class="number">Line</th><th>Code</th></tr>
					<tr><td class="number"><a name="addToExecList"></a>1</td><td><pre>&lt;?php
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>2</td><td><pre>/**
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>3</td><td><pre> * @author Olivier Mansour
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>4</td><td><pre> *
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>5</td><td><pre> * strongly depend on predis
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>6</td><td><pre> *
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>7</td><td><pre> */
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>8</td><td><pre>
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>9</td><td><pre>namespace M6Web\Component\Redis;
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>10</td><td><pre>
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>11</td><td><pre>use Predis;
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>12</td><td><pre>
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>13</td><td><pre>/**
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>14</td><td><pre> * Manager for Redis classes
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>15</td><td><pre> */
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>16</td><td><pre>abstract class Manager
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>17</td><td><pre>{
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>18</td><td><pre>
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>19</td><td><pre>    /**
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>20</td><td><pre>     * server default timeout
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>21</td><td><pre>     * @var float
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>22</td><td><pre>     */
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>23</td><td><pre>    protected $timeout = 0.2;
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>24</td><td><pre>
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>25</td><td><pre>    /**
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>26</td><td><pre>     * read write default timeout
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>27</td><td><pre>     * @var float
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>28</td><td><pre>     */
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>29</td><td><pre>    protected $read_write_timeout = 0.2;
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>30</td><td><pre>
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>31</td><td><pre>    /**
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>32</td><td><pre>     * array of server configuration
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>33</td><td><pre>     * @var array
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>34</td><td><pre>     */
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>35</td><td><pre>    protected $serverConfig = null;
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>36</td><td><pre>
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>37</td><td><pre>    /**
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>38</td><td><pre>     * array of Redis object
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>39</td><td><pre>     * @var array
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>40</td><td><pre>     */
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>41</td><td><pre>    protected $aliveRedis = array();
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>42</td><td><pre>
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>43</td><td><pre>    /**
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>44</td><td><pre>     * array of Redis object
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>45</td><td><pre>     * @var array
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>46</td><td><pre>     */
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>47</td><td><pre>    protected $deadRedis = array();
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>48</td><td><pre>
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>49</td><td><pre>    /**
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>50</td><td><pre>     * db (as redis understand it)
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>51</td><td><pre>     * @var integer
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>52</td><td><pre>     */
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>53</td><td><pre>    protected $currentDb;
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>54</td><td><pre>
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>55</td><td><pre>    /**
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>56</td><td><pre>     * do I use the compression
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>57</td><td><pre>     * @var bool
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>58</td><td><pre>     */
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>59</td><td><pre>    private $compress;
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>60</td><td><pre>
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>61</td><td><pre>    /**
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>62</td><td><pre>     * event dispatcher
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>63</td><td><pre>     * @var Object
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>64</td><td><pre>     */
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>65</td><td><pre>    protected $eventDispatcher = null;
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>66</td><td><pre>
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>67</td><td><pre>    /**
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>68</td><td><pre>     * class of the event notifier
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>69</td><td><pre>     * @var string
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>70</td><td><pre>     */
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>71</td><td><pre>    protected $eventClass = null;
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>72</td><td><pre>
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>73</td><td><pre>    /**
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>74</td><td><pre>     * number of reconnect if a command fail (passed to predisProxy)
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>75</td><td><pre>     * @var int
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>76</td><td><pre>     */
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>77</td><td><pre>    protected $reconnect = 0;
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>78</td><td><pre>
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>79</td><td><pre>    /**
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>80</td><td><pre>     * constructor
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>81</td><td><pre>     * $params = array(
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>82</td><td><pre>     * &#039;timeout&#039; =&gt; 2,
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>83</td><td><pre>     * &#039;compress&#039; =&gt; true,
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>84</td><td><pre>     * &#039;reconnect&#039; =&gt; 2
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>85</td><td><pre>     * &#039;server_config&#039; = array(
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>86</td><td><pre>     *   &#039;php50&#039; =&gt; array (
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>87</td><td><pre>     *       &#039;ip&#039; =&gt; &#039;193.22.143.110&#039;,
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>88</td><td><pre>     *       &#039;port&#039; =&gt; 6379,
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>89</td><td><pre>     *       ));
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>90</td><td><pre>     *
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>91</td><td><pre>     * @param array $params Manager params
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>92</td><td><pre>     *
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>93</td><td><pre>     * @return \M6Web\Component\Redis\Manager
</pre></td></tr><tr><td class="number"><a name="addToExecList"></a>94</td><td><pre>     */
</pre></td></tr><tr><td class="number"><a name="__construct"></a>95</td><td><pre>    public function __construct($params)
</pre></td></tr><tr><td class="number"><a name="__construct"></a>96</td><td><pre>    {
</pre></td></tr><tr><td class="number"><a name="__construct"></a>97</td><td><pre>        $this-&gt;init($params);
</pre></td></tr><tr><td class="number"><a name="__construct"></a>98</td><td><pre>
</pre></td></tr><tr><td class="number"><a name="__construct"></a>99</td><td><pre>        return $this;
</pre></td></tr><tr><td class="number"><a name="__construct"></a>100</td><td><pre>    }
</pre></td></tr><tr><td class="number"><a name="__construct"></a>101</td><td><pre>        
</pre></td></tr><tr><td class="number"><a name="__construct"></a>102</td><td><pre>    /**
</pre></td></tr><tr><td class="number"><a name="__construct"></a>103</td><td><pre>     * set the current db
</pre></td></tr><tr><td class="number"><a name="__construct"></a>104</td><td><pre>     *
</pre></td></tr><tr><td class="number"><a name="__construct"></a>105</td><td><pre>     * @param integer $v
</pre></td></tr><tr><td class="number"><a name="__construct"></a>106</td><td><pre>     *
</pre></td></tr><tr><td class="number"><a name="__construct"></a>107</td><td><pre>     * @throws Exception
</pre></td></tr><tr><td class="number"><a name="__construct"></a>108</td><td><pre>     * @return object DB
</pre></td></tr><tr><td class="number"><a name="__construct"></a>109</td><td><pre>     */
</pre></td></tr><tr><td class="number"><a name="setCurrentDb"></a>110</td><td><pre>    public function setCurrentDb($v)
</pre></td></tr><tr><td class="number"><a name="setCurrentDb"></a>111</td><td><pre>    {
</pre></td></tr><tr class="covered"><td class="number">112</td><td><pre>        if (!is_int($v)) {
</pre></td></tr><tr class="covered"><td class="number">113</td><td><pre>            throw new Exception(&quot;please describe the db as an integer ^^&quot;);
</pre></td></tr><tr><td class="number"><a name="setCurrentDb"></a>114</td><td><pre>        }
</pre></td></tr><tr class="covered"><td class="number">115</td><td><pre>        if ($v == Cache::CACHE) {
</pre></td></tr><tr class="covered"><td class="number">116</td><td><pre>            throw new Exception(&quot;cant use &quot;.Cache::CACHE.&quot; in class &quot;.__CLASS__);
</pre></td></tr><tr><td class="number"><a name="setCurrentDb"></a>117</td><td><pre>        }
</pre></td></tr><tr class="covered"><td class="number">118</td><td><pre>        $this-&gt;currentDb = $v;
</pre></td></tr><tr><td class="number"><a name="setCurrentDb"></a>119</td><td><pre>
</pre></td></tr><tr class="covered"><td class="number">120</td><td><pre>        return $this;
</pre></td></tr><tr><td class="number"><a name="setCurrentDb"></a>121</td><td><pre>    }
</pre></td></tr><tr><td class="number"><a name="setCurrentDb"></a>122</td><td><pre>
</pre></td></tr><tr><td class="number"><a name="setCurrentDb"></a>123</td><td><pre>    /**
</pre></td></tr><tr><td class="number"><a name="setCurrentDb"></a>124</td><td><pre>     * get the current db
</pre></td></tr><tr><td class="number"><a name="setCurrentDb"></a>125</td><td><pre>     * @throws Exception
</pre></td></tr><tr><td class="number"><a name="setCurrentDb"></a>126</td><td><pre>     * @return string|int
</pre></td></tr><tr><td class="number"><a name="setCurrentDb"></a>127</td><td><pre>     */
</pre></td></tr><tr><td class="number"><a name="getCurrentDb"></a>128</td><td><pre>    public function getCurrentDb()
</pre></td></tr><tr><td class="number"><a name="getCurrentDb"></a>129</td><td><pre>    {
</pre></td></tr><tr class="covered"><td class="number">130</td><td><pre>        if (is_null($this-&gt;currentDb)) {
</pre></td></tr><tr class="notCovered"><td class="number">131</td><td><pre>            throw new Exception(&quot;currentDb cant be null&quot;);
</pre></td></tr><tr><td class="number"><a name="getCurrentDb"></a>132</td><td><pre>        }
</pre></td></tr><tr><td class="number"><a name="getCurrentDb"></a>133</td><td><pre>
</pre></td></tr><tr class="covered"><td class="number">134</td><td><pre>        return $this-&gt;currentDb;
</pre></td></tr><tr><td class="number"><a name="getCurrentDb"></a>135</td><td><pre>    }
</pre></td></tr><tr><td class="number"><a name="getCurrentDb"></a>136</td><td><pre>
</pre></td></tr><tr><td class="number"><a name="getCurrentDb"></a>137</td><td><pre>    /**
</pre></td></tr><tr><td class="number"><a name="getCurrentDb"></a>138</td><td><pre>     * Notify an event to the event dispatcher
</pre></td></tr><tr><td class="number"><a name="getCurrentDb"></a>139</td><td><pre>     * @param string $command   The command name
</pre></td></tr><tr><td class="number"><a name="getCurrentDb"></a>140</td><td><pre>     * @param array  $arguments args of the command
</pre></td></tr><tr><td class="number"><a name="getCurrentDb"></a>141</td><td><pre>     * @param int    $time      exec time
</pre></td></tr><tr><td class="number"><a name="getCurrentDb"></a>142</td><td><pre>     *
</pre></td></tr><tr><td class="number"><a name="getCurrentDb"></a>143</td><td><pre>     * @return \M6Web\Component\Redis\Manager
</pre></td></tr><tr><td class="number"><a name="getCurrentDb"></a>144</td><td><pre>     */
</pre></td></tr><tr><td class="number"><a name="notifyEvent"></a>145</td><td><pre>    public function notifyEvent($command, $arguments, $time = 0)
</pre></td></tr><tr><td class="number"><a name="notifyEvent"></a>146</td><td><pre>    {
</pre></td></tr><tr class="covered"><td class="number">147</td><td><pre>        if ($this-&gt;eventDispatcher) {
</pre></td></tr><tr class="covered"><td class="number">148</td><td><pre>            $className = $this-&gt;eventClass;
</pre></td></tr><tr class="covered"><td class="number">149</td><td><pre>            $event = new $className();
</pre></td></tr><tr class="covered"><td class="number">150</td><td><pre>            $event-&gt;setCommand($command);
</pre></td></tr><tr class="covered"><td class="number">151</td><td><pre>            $event-&gt;setExecutionTime($time);
</pre></td></tr><tr class="covered"><td class="number">152</td><td><pre>            $event-&gt;setArguments($arguments);
</pre></td></tr><tr class="covered"><td class="number">153</td><td><pre>            $this-&gt;eventDispatcher-&gt;dispatch(&#039;redis.command&#039;, $event);
</pre></td></tr><tr class="covered"><td class="number">154</td><td><pre>        }
</pre></td></tr><tr><td class="number"><a name="notifyEvent"></a>155</td><td><pre>
</pre></td></tr><tr class="covered"><td class="number">156</td><td><pre>        return $this;
</pre></td></tr><tr><td class="number"><a name="notifyEvent"></a>157</td><td><pre>    }
</pre></td></tr><tr><td class="number"><a name="notifyEvent"></a>158</td><td><pre>
</pre></td></tr><tr><td class="number"><a name="notifyEvent"></a>159</td><td><pre>    /**
</pre></td></tr><tr><td class="number"><a name="notifyEvent"></a>160</td><td><pre>     * Set an event dispatcher to notify redis command
</pre></td></tr><tr><td class="number"><a name="notifyEvent"></a>161</td><td><pre>     * @param Object $eventDispatcher The eventDispatcher object, which implement the notify method
</pre></td></tr><tr><td class="number"><a name="notifyEvent"></a>162</td><td><pre>     * @param string $eventClass      The event class used to create an event and send it to the event dispatcher
</pre></td></tr><tr><td class="number"><a name="notifyEvent"></a>163</td><td><pre>     *
</pre></td></tr><tr><td class="number"><a name="notifyEvent"></a>164</td><td><pre>     * @throws Exception
</pre></td></tr><tr><td class="number"><a name="notifyEvent"></a>165</td><td><pre>     * @return \M6Web\Component\Redis\Manager
</pre></td></tr><tr><td class="number"><a name="notifyEvent"></a>166</td><td><pre>     */
</pre></td></tr><tr><td class="number"><a name="setEventDispatcher"></a>167</td><td><pre>    public function setEventDispatcher($eventDispatcher, $eventClass)
</pre></td></tr><tr><td class="number"><a name="setEventDispatcher"></a>168</td><td><pre>    {
</pre></td></tr><tr class="covered"><td class="number">169</td><td><pre>        if (!is_object($eventDispatcher) || !method_exists($eventDispatcher, &#039;dispatch&#039;)) {
</pre></td></tr><tr class="notCovered"><td class="number">170</td><td><pre>            throw new Exception(&quot;The EventDispatcher must be an object and implement a dispatch method&quot;);
</pre></td></tr><tr><td class="number"><a name="setEventDispatcher"></a>171</td><td><pre>        }
</pre></td></tr><tr><td class="number"><a name="setEventDispatcher"></a>172</td><td><pre>
</pre></td></tr><tr class="covered"><td class="number">173</td><td><pre>        if (!class_exists($eventClass) ||
</pre></td></tr><tr class="covered"><td class="number">174</td><td><pre>            !method_exists($eventClass, &#039;setCommand&#039;) ||
</pre></td></tr><tr class="covered"><td class="number">175</td><td><pre>            !method_exists($eventClass, &#039;setArguments&#039;) ||
</pre></td></tr><tr class="covered"><td class="number">176</td><td><pre>            !method_exists($eventClass, &#039;setExecutionTime&#039;)
</pre></td></tr><tr class="covered"><td class="number">177</td><td><pre>            ) {
</pre></td></tr><tr class="notCovered"><td class="number">178</td><td><pre>            $msg = &quot;The Event class : &quot;.$eventClass.&quot; must implement the setCommand, &quot;;
</pre></td></tr><tr class="notCovered"><td class="number">179</td><td><pre>            $msg .= &quot;setExecutionTime and the setArguments method&quot;;
</pre></td></tr><tr class="notCovered"><td class="number">180</td><td><pre>            throw new Exception($msg);
</pre></td></tr><tr><td class="number"><a name="setEventDispatcher"></a>181</td><td><pre>        }
</pre></td></tr><tr class="covered"><td class="number">182</td><td><pre>        $this-&gt;eventDispatcher = $eventDispatcher;
</pre></td></tr><tr class="covered"><td class="number">183</td><td><pre>        $this-&gt;eventClass      = $eventClass;
</pre></td></tr><tr><td class="number"><a name="setEventDispatcher"></a>184</td><td><pre>
</pre></td></tr><tr class="covered"><td class="number">185</td><td><pre>        return $this;
</pre></td></tr><tr><td class="number"><a name="setEventDispatcher"></a>186</td><td><pre>    }
</pre></td></tr><tr><td class="number"><a name="setEventDispatcher"></a>187</td><td><pre>
</pre></td></tr><tr><td class="number"><a name="setEventDispatcher"></a>188</td><td><pre>    /**
</pre></td></tr><tr><td class="number"><a name="setEventDispatcher"></a>189</td><td><pre>     * init for the class
</pre></td></tr><tr><td class="number"><a name="setEventDispatcher"></a>190</td><td><pre>     * @param array $params confg array
</pre></td></tr><tr><td class="number"><a name="setEventDispatcher"></a>191</td><td><pre>     *
</pre></td></tr><tr><td class="number"><a name="setEventDispatcher"></a>192</td><td><pre>     * @throws Exception
</pre></td></tr><tr><td class="number"><a name="setEventDispatcher"></a>193</td><td><pre>     * @return \M6Web\Component\Redis\Manager
</pre></td></tr><tr><td class="number"><a name="setEventDispatcher"></a>194</td><td><pre>     * @throw Exception
</pre></td></tr><tr><td class="number"><a name="setEventDispatcher"></a>195</td><td><pre>     */
</pre></td></tr><tr><td class="number"><a name="init"></a>196</td><td><pre>    protected function init($params)
</pre></td></tr><tr><td class="number"><a name="init"></a>197</td><td><pre>    {
</pre></td></tr><tr><td class="number"><a name="init"></a>198</td><td><pre>        // check serverConfig
</pre></td></tr><tr class="covered"><td class="number">199</td><td><pre>        if (!isset($params[&#039;server_config&#039;])) {
</pre></td></tr><tr class="notCovered"><td class="number">200</td><td><pre>            throw new Exception(&quot;parameter serverConfig is mandatory&quot;);
</pre></td></tr><tr><td class="number"><a name="init"></a>201</td><td><pre>        }
</pre></td></tr><tr><td class="number"><a name="init"></a>202</td><td><pre>
</pre></td></tr><tr class="covered"><td class="number">203</td><td><pre>        ksort($params[&#039;server_config&#039;]);
</pre></td></tr><tr class="covered"><td class="number">204</td><td><pre>        $this-&gt;setServerConfig($params[&#039;server_config&#039;]);
</pre></td></tr><tr class="covered"><td class="number">205</td><td><pre>        if (isset($params[&#039;timeout&#039;])) {
</pre></td></tr><tr class="covered"><td class="number">206</td><td><pre>            $this-&gt;timeout = $params[&#039;timeout&#039;];
</pre></td></tr><tr class="covered"><td class="number">207</td><td><pre>        }
</pre></td></tr><tr class="covered"><td class="number">208</td><td><pre>        if (isset($params[&#039;read_write_timeout&#039;])) {
</pre></td></tr><tr class="covered"><td class="number">209</td><td><pre>            $this-&gt;read_write_timeout = $params[&#039;read_write_timeout&#039;];
</pre></td></tr><tr class="covered"><td class="number">210</td><td><pre>        } else {
</pre></td></tr><tr><td class="number"><a name="init"></a>211</td><td><pre>            // use the same timeout
</pre></td></tr><tr class="covered"><td class="number">212</td><td><pre>            $this-&gt;read_write_timeout = $this-&gt;timeout;
</pre></td></tr><tr><td class="number"><a name="init"></a>213</td><td><pre>        }
</pre></td></tr><tr class="covered"><td class="number">214</td><td><pre>        if (isset($params[&#039;compress&#039;]) and is_bool($params[&#039;compress&#039;])) {
</pre></td></tr><tr class="covered"><td class="number">215</td><td><pre>            $this-&gt;compress = $params[&#039;compress&#039;];
</pre></td></tr><tr class="covered"><td class="number">216</td><td><pre>        }
</pre></td></tr><tr><td class="number"><a name="init"></a>217</td><td><pre>
</pre></td></tr><tr class="covered"><td class="number">218</td><td><pre>        if (isset($params[&#039;reconnect&#039;]) and is_int($params[&#039;reconnect&#039;])) {
</pre></td></tr><tr class="notCovered"><td class="number">219</td><td><pre>            $this-&gt;reconnect = $params[&#039;reconnect&#039;];
</pre></td></tr><tr class="notCovered"><td class="number">220</td><td><pre>        }
</pre></td></tr><tr><td class="number"><a name="init"></a>221</td><td><pre>
</pre></td></tr><tr class="covered"><td class="number">222</td><td><pre>        return $this;
</pre></td></tr><tr><td class="number"><a name="init"></a>223</td><td><pre>    }
</pre></td></tr><tr><td class="number"><a name="init"></a>224</td><td><pre>
</pre></td></tr><tr><td class="number"><a name="init"></a>225</td><td><pre>    /**
</pre></td></tr><tr><td class="number"><a name="init"></a>226</td><td><pre>     * retourn compress param
</pre></td></tr><tr><td class="number"><a name="init"></a>227</td><td><pre>     * @return bool
</pre></td></tr><tr><td class="number"><a name="init"></a>228</td><td><pre>     */
</pre></td></tr><tr><td class="number"><a name="getCompress"></a>229</td><td><pre>    public function getCompress()
</pre></td></tr><tr><td class="number"><a name="getCompress"></a>230</td><td><pre>    {
</pre></td></tr><tr class="covered"><td class="number">231</td><td><pre>        return $this-&gt;compress;
</pre></td></tr><tr><td class="number"><a name="getCompress"></a>232</td><td><pre>    }
</pre></td></tr><tr><td class="number"><a name="getCompress"></a>233</td><td><pre>
</pre></td></tr><tr><td class="number"><a name="getCompress"></a>234</td><td><pre>    /**
</pre></td></tr><tr><td class="number"><a name="getCompress"></a>235</td><td><pre>     * check the server config
</pre></td></tr><tr><td class="number"><a name="getCompress"></a>236</td><td><pre>     * @param array $servers host_config
</pre></td></tr><tr><td class="number"><a name="getCompress"></a>237</td><td><pre>     *
</pre></td></tr><tr><td class="number"><a name="getCompress"></a>238</td><td><pre>     * @return boolean
</pre></td></tr><tr><td class="number"><a name="getCompress"></a>239</td><td><pre>     */
</pre></td></tr><tr><td class="number"><a name="checkServerConfig"></a>240</td><td><pre>    protected function checkServerConfig($servers)
</pre></td></tr><tr><td class="number"><a name="checkServerConfig"></a>241</td><td><pre>    {
</pre></td></tr><tr class="covered"><td class="number">242</td><td><pre>        if (!is_array($servers)) {
</pre></td></tr><tr class="notCovered"><td class="number">243</td><td><pre>            return false;
</pre></td></tr><tr><td class="number"><a name="checkServerConfig"></a>244</td><td><pre>        }
</pre></td></tr><tr class="covered"><td class="number">245</td><td><pre>        foreach ($servers as $serverId =&gt; $server) {
</pre></td></tr><tr class="covered"><td class="number">246</td><td><pre>            if (!is_string($serverId)) {
</pre></td></tr><tr class="notCovered"><td class="number">247</td><td><pre>                return false;
</pre></td></tr><tr><td class="number"><a name="checkServerConfig"></a>248</td><td><pre>            }
</pre></td></tr><tr class="covered"><td class="number">249</td><td><pre>            if (!isset($server[&#039;ip&#039;]) or !isset($server[&#039;port&#039;])) {
</pre></td></tr><tr class="notCovered"><td class="number">250</td><td><pre>                return false;
</pre></td></tr><tr><td class="number"><a name="checkServerConfig"></a>251</td><td><pre>            }
</pre></td></tr><tr class="covered"><td class="number">252</td><td><pre>        }
</pre></td></tr><tr><td class="number"><a name="checkServerConfig"></a>253</td><td><pre>
</pre></td></tr><tr class="covered"><td class="number">254</td><td><pre>        return true;
</pre></td></tr><tr><td class="number"><a name="checkServerConfig"></a>255</td><td><pre>    }
</pre></td></tr><tr><td class="number"><a name="checkServerConfig"></a>256</td><td><pre>
</pre></td></tr><tr><td class="number"><a name="checkServerConfig"></a>257</td><td><pre>    /**
</pre></td></tr><tr><td class="number"><a name="checkServerConfig"></a>258</td><td><pre>     * getTimeout
</pre></td></tr><tr><td class="number"><a name="checkServerConfig"></a>259</td><td><pre>     *
</pre></td></tr><tr><td class="number"><a name="checkServerConfig"></a>260</td><td><pre>     * @return float
</pre></td></tr><tr><td class="number"><a name="checkServerConfig"></a>261</td><td><pre>     */
</pre></td></tr><tr><td class="number"><a name="getTimeout"></a>262</td><td><pre>    public function getTimeout()
</pre></td></tr><tr><td class="number"><a name="getTimeout"></a>263</td><td><pre>    {
</pre></td></tr><tr class="covered"><td class="number">264</td><td><pre>        return (float) $this-&gt;timeout;
</pre></td></tr><tr><td class="number"><a name="getTimeout"></a>265</td><td><pre>    }
</pre></td></tr><tr><td class="number"><a name="getTimeout"></a>266</td><td><pre>
</pre></td></tr><tr><td class="number"><a name="getTimeout"></a>267</td><td><pre>    /**
</pre></td></tr><tr><td class="number"><a name="getTimeout"></a>268</td><td><pre>     * getReadWriteTimeout
</pre></td></tr><tr><td class="number"><a name="getTimeout"></a>269</td><td><pre>     *
</pre></td></tr><tr><td class="number"><a name="getTimeout"></a>270</td><td><pre>     * @return float
</pre></td></tr><tr><td class="number"><a name="getTimeout"></a>271</td><td><pre>     */
</pre></td></tr><tr><td class="number"><a name="getReadWriteTimeout"></a>272</td><td><pre>    public function getReadWriteTimeout()
</pre></td></tr><tr><td class="number"><a name="getReadWriteTimeout"></a>273</td><td><pre>    {
</pre></td></tr><tr class="covered"><td class="number">274</td><td><pre>        return (float) $this-&gt;read_write_timeout;
</pre></td></tr><tr><td class="number"><a name="getReadWriteTimeout"></a>275</td><td><pre>    }
</pre></td></tr><tr><td class="number"><a name="getReadWriteTimeout"></a>276</td><td><pre>
</pre></td></tr><tr><td class="number"><a name="getReadWriteTimeout"></a>277</td><td><pre>    /**
</pre></td></tr><tr><td class="number"><a name="getReadWriteTimeout"></a>278</td><td><pre>     * get the server info against servernam or all the config
</pre></td></tr><tr><td class="number"><a name="getReadWriteTimeout"></a>279</td><td><pre>     * @param int $servername cl&eacute;
</pre></td></tr><tr><td class="number"><a name="getReadWriteTimeout"></a>280</td><td><pre>     *
</pre></td></tr><tr><td class="number"><a name="getReadWriteTimeout"></a>281</td><td><pre>     * @return array
</pre></td></tr><tr><td class="number"><a name="getReadWriteTimeout"></a>282</td><td><pre>     */
</pre></td></tr><tr><td class="number"><a name="getServerConfig"></a>283</td><td><pre>    public function getServerConfig($servername = null)
</pre></td></tr><tr><td class="number"><a name="getServerConfig"></a>284</td><td><pre>    {
</pre></td></tr><tr class="covered"><td class="number">285</td><td><pre>        if (is_null($servername)) {
</pre></td></tr><tr class="covered"><td class="number">286</td><td><pre>            return $this-&gt;serverConfig;
</pre></td></tr><tr><td class="number"><a name="getServerConfig"></a>287</td><td><pre>        } else {
</pre></td></tr><tr class="covered"><td class="number">288</td><td><pre>            return $this-&gt;serverConfig[$servername];
</pre></td></tr><tr><td class="number"><a name="getServerConfig"></a>289</td><td><pre>        }
</pre></td></tr><tr><td class="number"><a name="getServerConfig"></a>290</td><td><pre>    }
</pre></td></tr><tr><td class="number"><a name="getServerConfig"></a>291</td><td><pre>
</pre></td></tr><tr><td class="number"><a name="getServerConfig"></a>292</td><td><pre>    /**
</pre></td></tr><tr><td class="number"><a name="getServerConfig"></a>293</td><td><pre>     * set the server config
</pre></td></tr><tr><td class="number"><a name="getServerConfig"></a>294</td><td><pre>     * @param array $servers config
</pre></td></tr><tr><td class="number"><a name="getServerConfig"></a>295</td><td><pre>     * @param bool  $check   do I have to check the config
</pre></td></tr><tr><td class="number"><a name="getServerConfig"></a>296</td><td><pre>     *
</pre></td></tr><tr><td class="number"><a name="getServerConfig"></a>297</td><td><pre>     * @throws Exception
</pre></td></tr><tr><td class="number"><a name="getServerConfig"></a>298</td><td><pre>     * @return \M6Web\Component\Redis\Manager
</pre></td></tr><tr><td class="number"><a name="getServerConfig"></a>299</td><td><pre>     */
</pre></td></tr><tr><td class="number"><a name="setServerConfig"></a>300</td><td><pre>    protected function setServerConfig($servers, $check = true)
</pre></td></tr><tr><td class="number"><a name="setServerConfig"></a>301</td><td><pre>    {
</pre></td></tr><tr class="covered"><td class="number">302</td><td><pre>        if ($check and (!self::checkServerConfig($servers))) {
</pre></td></tr><tr class="notCovered"><td class="number">303</td><td><pre>            throw new Exception(&quot;Le parametre serverConfig est mal form&eacute;&quot;);
</pre></td></tr><tr><td class="number"><a name="setServerConfig"></a>304</td><td><pre>        }
</pre></td></tr><tr><td class="number"><a name="setServerConfig"></a>305</td><td><pre>        // allow set only if the class var is null (one init only)
</pre></td></tr><tr class="covered"><td class="number">306</td><td><pre>        if (is_null($this-&gt;serverConfig)) {
</pre></td></tr><tr class="covered"><td class="number">307</td><td><pre>            $this-&gt;serverConfig = $servers;
</pre></td></tr><tr class="covered"><td class="number">308</td><td><pre>        }
</pre></td></tr><tr><td class="number"><a name="setServerConfig"></a>309</td><td><pre>
</pre></td></tr><tr class="covered"><td class="number">310</td><td><pre>        return $this;
</pre></td></tr><tr><td class="number"><a name="setServerConfig"></a>311</td><td><pre>    }
</pre></td></tr><tr><td class="number"><a name="setServerConfig"></a>312</td><td><pre>
</pre></td></tr><tr><td class="number"><a name="setServerConfig"></a>313</td><td><pre>    /**
</pre></td></tr><tr><td class="number"><a name="setServerConfig"></a>314</td><td><pre>     * return a server according to the redis key passed
</pre></td></tr><tr><td class="number"><a name="setServerConfig"></a>315</td><td><pre>     * @param string $key     server name
</pre></td></tr><tr><td class="number"><a name="setServerConfig"></a>316</td><td><pre>     * @param array  $servers array of servers
</pre></td></tr><tr><td class="number"><a name="setServerConfig"></a>317</td><td><pre>     *
</pre></td></tr><tr><td class="number"><a name="setServerConfig"></a>318</td><td><pre>     * @return mixed
</pre></td></tr><tr><td class="number"><a name="setServerConfig"></a>319</td><td><pre>     */
</pre></td></tr><tr><td class="number"><a name="getServerId"></a>320</td><td><pre>    protected function getServerId($key, $servers = null)
</pre></td></tr><tr><td class="number"><a name="getServerId"></a>321</td><td><pre>    {
</pre></td></tr><tr class="covered"><td class="number">322</td><td><pre>        if (is_null($servers)) {
</pre></td></tr><tr class="covered"><td class="number">323</td><td><pre>            $servers = $this-&gt;getServerConfig();
</pre></td></tr><tr class="covered"><td class="number">324</td><td><pre>        }
</pre></td></tr><tr class="covered"><td class="number">325</td><td><pre>        $serverKeys = array_keys($servers);
</pre></td></tr><tr><td class="number"><a name="getServerId"></a>326</td><td><pre>
</pre></td></tr><tr class="covered"><td class="number">327</td><td><pre>        return $serverKeys[(int) (crc32($key) % count($serverKeys))];
</pre></td></tr><tr><td class="number"><a name="getServerId"></a>328</td><td><pre>    }
</pre></td></tr><tr><td class="number"><a name="getServerId"></a>329</td><td><pre>
</pre></td></tr><tr><td class="number"><a name="getServerId"></a>330</td><td><pre>    /**
</pre></td></tr><tr><td class="number"><a name="getServerId"></a>331</td><td><pre>     * return a Redis object according to the key
</pre></td></tr><tr><td class="number"><a name="getServerId"></a>332</td><td><pre>     * @param string $key     cache key
</pre></td></tr><tr><td class="number"><a name="getServerId"></a>333</td><td><pre>     * @param array  $servers servers
</pre></td></tr><tr><td class="number"><a name="getServerId"></a>334</td><td><pre>     *
</pre></td></tr><tr><td class="number"><a name="getServerId"></a>335</td><td><pre>     * @throws Exception
</pre></td></tr><tr><td class="number"><a name="getServerId"></a>336</td><td><pre>     * @return object
</pre></td></tr><tr><td class="number"><a name="getServerId"></a>337</td><td><pre>     */
</pre></td></tr><tr><td class="number"><a name="getRedis"></a>338</td><td><pre>    protected function getRedis($key, $servers = null)
</pre></td></tr><tr><td class="number"><a name="getRedis"></a>339</td><td><pre>    {
</pre></td></tr><tr class="covered"><td class="number">340</td><td><pre>        if (is_null($servers)) {
</pre></td></tr><tr class="covered"><td class="number">341</td><td><pre>            $servers = $this-&gt;getServerConfig(); // all the servers
</pre></td></tr><tr class="covered"><td class="number">342</td><td><pre>        }
</pre></td></tr><tr class="covered"><td class="number">343</td><td><pre>        if (0 == count($servers)) {
</pre></td></tr><tr class="covered"><td class="number">344</td><td><pre>            throw new Exception(&quot;No redis server available ! &quot;);
</pre></td></tr><tr><td class="number"><a name="getRedis"></a>345</td><td><pre>        }
</pre></td></tr><tr class="covered"><td class="number">346</td><td><pre>        $idServer = $this-&gt;getServerId($key, $servers);
</pre></td></tr><tr><td class="number"><a name="getRedis"></a>347</td><td><pre>
</pre></td></tr><tr class="covered"><td class="number">348</td><td><pre>        if (!($redis = $this-&gt;getRedisFromServerConfig($idServer))) {
</pre></td></tr><tr class="covered"><td class="number">349</td><td><pre>            $this-&gt;notifyEvent(&#039;redis_host_on_error&#039;, array($idServer));
</pre></td></tr><tr><td class="number"><a name="getRedis"></a>350</td><td><pre>            // find another server !!!
</pre></td></tr><tr class="covered"><td class="number">351</td><td><pre>            unset($servers[$idServer]); // supress the server
</pre></td></tr><tr><td class="number"><a name="getRedis"></a>352</td><td><pre>
</pre></td></tr><tr class="covered"><td class="number">353</td><td><pre>            return $this-&gt;getRedis($key, $servers); // RECURSION ^^
</pre></td></tr><tr><td class="number"><a name="getRedis"></a>354</td><td><pre>        }
</pre></td></tr><tr class="covered"><td class="number">355</td><td><pre>        $redis-&gt;select($this-&gt;getCurrentDb());
</pre></td></tr><tr><td class="number"><a name="getRedis"></a>356</td><td><pre>
</pre></td></tr><tr class="covered"><td class="number">357</td><td><pre>        return $redis;
</pre></td></tr><tr><td class="number"><a name="getRedis"></a>358</td><td><pre>    }
</pre></td></tr><tr><td class="number"><a name="getRedis"></a>359</td><td><pre>
</pre></td></tr><tr><td class="number"><a name="getRedis"></a>360</td><td><pre>    /**
</pre></td></tr><tr><td class="number"><a name="getRedis"></a>361</td><td><pre>     * buid a redis server with a config
</pre></td></tr><tr><td class="number"><a name="getRedis"></a>362</td><td><pre>     * @param string $idServer server id in the configuration
</pre></td></tr><tr><td class="number"><a name="getRedis"></a>363</td><td><pre>     *
</pre></td></tr><tr><td class="number"><a name="getRedis"></a>364</td><td><pre>     * @return object|false
</pre></td></tr><tr><td class="number"><a name="getRedis"></a>365</td><td><pre>     */
</pre></td></tr><tr><td class="number"><a name="getRedisFromServerConfig"></a>366</td><td><pre>    public function getRedisFromServerConfig($idServer)
</pre></td></tr><tr><td class="number"><a name="getRedisFromServerConfig"></a>367</td><td><pre>    {
</pre></td></tr><tr><td class="number"><a name="getRedisFromServerConfig"></a>368</td><td><pre>        // redis already marked dead
</pre></td></tr><tr class="covered"><td class="number">369</td><td><pre>        if (array_key_exists($idServer, $this-&gt;deadRedis)) {
</pre></td></tr><tr class="covered"><td class="number">370</td><td><pre>            return false;
</pre></td></tr><tr><td class="number"><a name="getRedisFromServerConfig"></a>371</td><td><pre>        }
</pre></td></tr><tr><td class="number"><a name="getRedisFromServerConfig"></a>372</td><td><pre>        // redis already marked alive
</pre></td></tr><tr class="covered"><td class="number">373</td><td><pre>        if (array_key_exists($idServer, $this-&gt;aliveRedis)) {
</pre></td></tr><tr class="covered"><td class="number">374</td><td><pre>            if (!$this-&gt;aliveRedis[$idServer]-&gt;isConnected()) {
</pre></td></tr><tr class="notCovered"><td class="number">375</td><td><pre>                $this-&gt;deadRedis[$idServer] = 1;
</pre></td></tr><tr><td class="number"><a name="getRedisFromServerConfig"></a>376</td><td><pre>
</pre></td></tr><tr class="notCovered"><td class="number">377</td><td><pre>                return false;
</pre></td></tr><tr><td class="number"><a name="getRedisFromServerConfig"></a>378</td><td><pre>            }
</pre></td></tr><tr><td class="number"><a name="getRedisFromServerConfig"></a>379</td><td><pre>
</pre></td></tr><tr class="covered"><td class="number">380</td><td><pre>            return $this-&gt;aliveRedis[$idServer];
</pre></td></tr><tr><td class="number"><a name="getRedisFromServerConfig"></a>381</td><td><pre>        }
</pre></td></tr><tr><td class="number"><a name="getRedisFromServerConfig"></a>382</td><td><pre>
</pre></td></tr><tr class="covered"><td class="number">383</td><td><pre>        $redis = $this-&gt;getNewRedis();
</pre></td></tr><tr class="covered"><td class="number">384</td><td><pre>        if ($this-&gt;connectServer($redis, $this-&gt;getServerConfig($idServer))) {
</pre></td></tr><tr class="covered"><td class="number">385</td><td><pre>            $this-&gt;aliveRedis[$idServer] = $redis;
</pre></td></tr><tr><td class="number"><a name="getRedisFromServerConfig"></a>386</td><td><pre>
</pre></td></tr><tr class="covered"><td class="number">387</td><td><pre>            return $redis;
</pre></td></tr><tr><td class="number"><a name="getRedisFromServerConfig"></a>388</td><td><pre>        } else {
</pre></td></tr><tr class="covered"><td class="number">389</td><td><pre>            $this-&gt;deadRedis[$idServer] = 1;
</pre></td></tr><tr><td class="number"><a name="getRedisFromServerConfig"></a>390</td><td><pre>
</pre></td></tr><tr class="covered"><td class="number">391</td><td><pre>            return false;
</pre></td></tr><tr><td class="number"><a name="getRedisFromServerConfig"></a>392</td><td><pre>        }
</pre></td></tr><tr><td class="number"><a name="getRedisFromServerConfig"></a>393</td><td><pre>    }
</pre></td></tr><tr><td class="number"><a name="getRedisFromServerConfig"></a>394</td><td><pre>
</pre></td></tr><tr><td class="number"><a name="getRedisFromServerConfig"></a>395</td><td><pre>    /**
</pre></td></tr><tr><td class="number"><a name="getRedisFromServerConfig"></a>396</td><td><pre>     * return a Predis object
</pre></td></tr><tr><td class="number"><a name="getRedisFromServerConfig"></a>397</td><td><pre>     *
</pre></td></tr><tr><td class="number"><a name="getRedisFromServerConfig"></a>398</td><td><pre>     * @throws Exception
</pre></td></tr><tr><td class="number"><a name="getRedisFromServerConfig"></a>399</td><td><pre>     * @return PredisProxy
</pre></td></tr><tr><td class="number"><a name="getRedisFromServerConfig"></a>400</td><td><pre>     */
</pre></td></tr><tr><td class="number"><a name="getNewRedis"></a>401</td><td><pre>    protected function getNewRedis()
</pre></td></tr><tr><td class="number"><a name="getNewRedis"></a>402</td><td><pre>    {
</pre></td></tr><tr class="covered"><td class="number">403</td><td><pre>        $proxy = new PredisProxy();
</pre></td></tr><tr><td class="number"><a name="getNewRedis"></a>404</td><td><pre>
</pre></td></tr><tr class="covered"><td class="number">405</td><td><pre>        return $proxy-&gt;setMaxConnectionLostAllowed($this-&gt;reconnect);
</pre></td></tr><tr><td class="number"><a name="getNewRedis"></a>406</td><td><pre>    }
</pre></td></tr><tr><td class="number"><a name="getNewRedis"></a>407</td><td><pre>
</pre></td></tr><tr><td class="number"><a name="getNewRedis"></a>408</td><td><pre>    /**
</pre></td></tr><tr><td class="number"><a name="getNewRedis"></a>409</td><td><pre>     * connecte un server
</pre></td></tr><tr><td class="number"><a name="getNewRedis"></a>410</td><td><pre>     * @param object|\Predis\Client $redis  \Predis\Client
</pre></td></tr><tr><td class="number"><a name="getNewRedis"></a>411</td><td><pre>     * @param array                 $server array(&#039;ip&#039; =&gt; , &#039;port&#039; =&gt; , &#039;timeout&#039; =&gt;)
</pre></td></tr><tr><td class="number"><a name="getNewRedis"></a>412</td><td><pre>     *
</pre></td></tr><tr><td class="number"><a name="getNewRedis"></a>413</td><td><pre>     * @return boolean
</pre></td></tr><tr><td class="number"><a name="getNewRedis"></a>414</td><td><pre>     */
</pre></td></tr><tr><td class="number"><a name="connectServer"></a>415</td><td><pre>    protected function connectServer(PredisProxy $redis, $server)
</pre></td></tr><tr><td class="number"><a name="connectServer"></a>416</td><td><pre>    {
</pre></td></tr><tr><td class="number"><a name="connectServer"></a>417</td><td><pre>        try {
</pre></td></tr><tr class="covered"><td class="number">418</td><td><pre>            $redis-&gt;callRedisConstructor(array(
</pre></td></tr><tr class="covered"><td class="number">419</td><td><pre>                &#039;host&#039; =&gt; $server[&#039;ip&#039;],
</pre></td></tr><tr class="covered"><td class="number">420</td><td><pre>                &#039;port&#039; =&gt; (int) $server[&#039;port&#039;],
</pre></td></tr><tr class="covered"><td class="number">421</td><td><pre>                &#039;timeout&#039; =&gt; $this-&gt;getTimeout(),
</pre></td></tr><tr class="covered"><td class="number">422</td><td><pre>                &#039;read_write_timeout&#039; =&gt; $this-&gt;getReadWriteTimeout()
</pre></td></tr><tr class="covered"><td class="number">423</td><td><pre>                ));
</pre></td></tr><tr><td class="number"><a name="connectServer"></a>424</td><td><pre>                // check if we are connected
</pre></td></tr><tr class="covered"><td class="number">425</td><td><pre>            $redis-&gt;connect();
</pre></td></tr><tr><td class="number"><a name="connectServer"></a>426</td><td><pre>
</pre></td></tr><tr class="covered"><td class="number">427</td><td><pre>            return true;
</pre></td></tr><tr class="covered"><td class="number">428</td><td><pre>        } catch (Predis\Connection\ConnectionException $e) {
</pre></td></tr><tr class="covered"><td class="number">429</td><td><pre>            return false;
</pre></td></tr><tr><td class="number"><a name="connectServer"></a>430</td><td><pre>        }
</pre></td></tr><tr><td class="number"><a name="connectServer"></a>431</td><td><pre>
</pre></td></tr><tr><td class="number"><a name="connectServer"></a>432</td><td><pre>    }
</pre></td></tr><tr><td class="number"><a name="connectServer"></a>433</td><td><pre>
</pre></td></tr><tr><td class="number"><a name="connectServer"></a>434</td><td><pre>    /**
</pre></td></tr><tr><td class="number"><a name="connectServer"></a>435</td><td><pre>     * compress a string
</pre></td></tr><tr><td class="number"><a name="connectServer"></a>436</td><td><pre>     * @param string $data a data to compress
</pre></td></tr><tr><td class="number"><a name="connectServer"></a>437</td><td><pre>     *
</pre></td></tr><tr><td class="number"><a name="connectServer"></a>438</td><td><pre>     * @return string
</pre></td></tr><tr><td class="number"><a name="connectServer"></a>439</td><td><pre>     */
</pre></td></tr><tr><td class="number"><a name="compress"></a>440</td><td><pre>    protected static function compress($data)
</pre></td></tr><tr><td class="number"><a name="compress"></a>441</td><td><pre>    {
</pre></td></tr><tr class="covered"><td class="number">442</td><td><pre>        return gzcompress($data);
</pre></td></tr><tr><td class="number"><a name="compress"></a>443</td><td><pre>    }
</pre></td></tr><tr><td class="number"><a name="compress"></a>444</td><td><pre>
</pre></td></tr><tr><td class="number"><a name="compress"></a>445</td><td><pre>    /**
</pre></td></tr><tr><td class="number"><a name="compress"></a>446</td><td><pre>     * uncompress a string
</pre></td></tr><tr><td class="number"><a name="compress"></a>447</td><td><pre>     * @param string $data data to uncompress
</pre></td></tr><tr><td class="number"><a name="compress"></a>448</td><td><pre>     *
</pre></td></tr><tr><td class="number"><a name="compress"></a>449</td><td><pre>     * @return string
</pre></td></tr><tr><td class="number"><a name="compress"></a>450</td><td><pre>     */
</pre></td></tr><tr><td class="number"><a name="uncompress"></a>451</td><td><pre>    protected static function uncompress($data)
</pre></td></tr><tr><td class="number"><a name="uncompress"></a>452</td><td><pre>    {
</pre></td></tr><tr class="covered"><td class="number">453</td><td><pre>        return gzuncompress($data);
</pre></td></tr><tr><td class="number"><a name="uncompress"></a>454</td><td><pre>    }
</pre></td></tr><tr><td class="number"><a name="uncompress"></a>455</td><td><pre>
</pre></td></tr><tr><td class="number"><a name="uncompress"></a>456</td><td><pre>
</pre></td></tr><tr><td class="number"><a name="uncompress"></a>457</td><td><pre>    /**
</pre></td></tr><tr><td class="number"><a name="uncompress"></a>458</td><td><pre>     * forget all server marker dead or alive
</pre></td></tr><tr><td class="number"><a name="uncompress"></a>459</td><td><pre>     *
</pre></td></tr><tr><td class="number"><a name="uncompress"></a>460</td><td><pre>     * @return $this
</pre></td></tr><tr><td class="number"><a name="uncompress"></a>461</td><td><pre>     */
</pre></td></tr><tr><td class="number"><a name="forgetDeadOrAliveRedis"></a>462</td><td><pre>    public function forgetDeadOrAliveRedis()
</pre></td></tr><tr><td class="number"><a name="forgetDeadOrAliveRedis"></a>463</td><td><pre>    {
</pre></td></tr><tr class="notCovered"><td class="number">464</td><td><pre>        $this-&gt;deadRedis  = array();
</pre></td></tr><tr class="notCovered"><td class="number">465</td><td><pre>        $this-&gt;aliveRedis = array();
</pre></td></tr><tr><td class="number"><a name="forgetDeadOrAliveRedis"></a>466</td><td><pre>
</pre></td></tr><tr class="notCovered"><td class="number">467</td><td><pre>        return $this;
</pre></td></tr><tr><td class="number"><a name="forgetDeadOrAliveRedis"></a>468</td><td><pre>    }
</pre></td></tr><tr><td class="number"><a name="forgetDeadOrAliveRedis"></a>469</td><td><pre>}
</pre></td></tr>
				</table>
			</div>
		</div>
		<div id="footer">
			<p>Code coverage report powered by <a href="http://atoum.org">atoum</a></p>
		</div>
	</body>
</html>
